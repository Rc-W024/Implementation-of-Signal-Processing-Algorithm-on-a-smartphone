/*
 * Academic License - for use in teaching, academic research, and meeting
 * course requirements at degree granting institutions only.  Not for
 * government, commercial, or other organizational use.
 * File: Echo.c
 *
 * MATLAB Coder version            : 3.0
 * C/C++ source code generated on  : 28-Apr-2016 12:21:36
 */

/* Include Files */
#include "rt_nonfinite.h"
#include "Echo.h"
#include "filter.h"
#include "Echo_emxutil.h"

/* Function Definitions */

/*
 * Echo cancellation
 * Original Signal
 * Arguments    : float a
 *                float delay
 *                float x[999]
 *                float x_delay[999]
 *                float Q[999]
 * Return Type  : void
 */
void Echo(float a, float delay, float *x, float *x_delay, float *Q)
{
  static const float fv0[999] = { 0.250666469F, 0.49737981F, 0.736249149F,
    0.963507414F, 1.17557061F, 1.36909437F, 1.54102659F, 1.68865585F,
    1.80965424F, 1.90211308F, 1.96457458F, 1.99605346F, 1.99605346F, 1.96457446F,
    1.90211296F, 1.809654F, 1.68865573F, 1.54102623F, 1.36909378F, 1.17557F,
    0.963506699F, 0.736248314F, 0.497378886F, 0.250665933F, -1.74845553E-7F,
    -0.250666738F, -0.497380137F, -0.736249566F, -0.963507831F, -1.17557108F,
    -1.36909473F, -1.54102671F, -1.68865609F, -1.80965436F, -1.9021132F,
    -1.96457469F, -1.99605346F, -1.99605334F, -1.96457446F, -1.9021126F,
    -1.809654F, -1.68865514F, -1.54102612F, -1.36909306F, -1.17556989F,
    -0.963505745F, -0.736248195F, -0.497378707F, -0.250665277F, 3.49691106E-7F,
    0.25066787F, 0.497380316F, 0.736250579F, 0.963508F, 1.17557192F, 1.36909485F,
    1.54102778F, 1.68865645F, 1.80965459F, 1.90211344F, 1.96457481F, 1.99605358F,
    1.99605346F, 1.96457434F, 1.90211213F, 1.80965364F, 1.68865526F, 1.54102564F,
    1.36909318F, 1.1755693F, 0.963506F, 0.736247599F, 0.497378081F, 0.250664622F,
    -1.95504822E-6F, -0.250668496F, -0.497381866F, -0.736249447F, -0.96350944F,
    -1.17557251F, -1.36909473F, -1.54102695F, -1.6886574F, -1.80965531F,
    -1.90211332F, -1.96457469F, -1.99605358F, -1.99605322F, -1.96457422F,
    -1.90211248F, -1.8096534F, -1.68865383F, -1.54102528F, -1.3690927F,
    -1.17556882F, -0.963505447F, -0.736246943F, -0.497377455F, -0.250664F,
    6.99382213E-7F, 0.250669152F, 0.497382492F, 0.736251831F, 0.963508308F,
    1.17557299F, 1.36909652F, 1.54102862F, 1.68865669F, 1.80965483F, 1.90211415F,
    1.96457517F, 1.99605358F, 1.99605334F, 1.96457374F, 1.90211236F, 1.80965316F,
    1.68865454F, 1.54102492F, 1.36909223F, 1.17556822F, 0.963504851F,
    0.736246347F, 0.497376829F, 0.25066334F, -1.35106495E-6F, -0.2506679F,
    -0.49738127F, -0.736250639F, -0.963508904F, -1.17557514F, -1.36909842F,
    -1.54102778F, -1.68865705F, -1.80965507F, -1.9021138F, -1.96457493F,
    -1.99605358F, -1.99605334F, -1.96457326F, -1.90211213F, -1.80965281F,
    -1.68865418F, -1.54102445F, -1.36909187F, -1.17556775F, -0.963504255F,
    -0.736249328F, -0.497376174F, -0.250662684F, 3.91009644E-6F, 0.250670433F,
    0.497383773F, 0.736253F, 0.963511109F, 1.17557096F, 1.36909473F, 1.54102945F,
    1.68865836F, 1.80965614F, 1.90211451F, 1.96457541F, 1.99605358F, 1.99605334F,
    1.96457422F, 1.90211248F, 1.80965173F, 1.68865287F, 1.54102278F, 1.36909F,
    1.17556882F, 0.963505387F, 0.736246943F, 0.497377396F, 0.250663936F,
    -6.46912758E-6F, -0.250673F, -0.497382551F, -0.736251831F, -0.963510036F,
    -1.17557311F, -1.36909664F, -1.54102862F, -1.68865776F, -1.80965722F,
    -1.90211415F, -1.96457517F, -1.9960537F, -1.99605322F, -1.96457374F,
    -1.90211177F, -1.80965233F, -1.68865347F, -1.54102361F, -1.3690908F,
    -1.17556667F, -0.963503122F, -0.736244559F, -0.497374922F, -0.250661403F,
    1.39876443E-6F, 0.250671744F, 0.497385025F, 0.736254215F, 0.963512301F,
    1.17557514F, 1.36909842F, 1.54103029F, 1.68865705F, 1.80965507F, 1.90211499F,
    1.96457565F, 1.99605381F, 1.9960531F, 1.96457326F, 1.90211213F, 1.80965281F,
    1.68865418F, 1.54102445F, 1.36908901F, 1.17556465F, 0.963500917F,
    0.736242175F, 0.497376144F, 0.250662655F, -3.9577958E-6F, -0.250670493F,
    -0.497383803F, -0.736256599F, -0.963514507F, -1.17557406F, -1.36909759F,
    -1.54102945F, -1.68865836F, -1.80965614F, -1.90211463F, -1.96457541F,
    -1.99605405F, -1.9960531F, -1.9645735F, -1.90211129F, -1.80965173F,
    -1.68865275F, -1.54102278F, -1.36908984F, -1.1755687F, -0.963502F,
    -0.736243308F, -0.49737367F, -0.250660092F, 2.70213E-6F, 0.250673026F,
    0.497382581F, 0.736255467F, 0.963510096F, 1.17557931F, 1.36909664F,
    1.54102862F, 1.68865776F, 1.80965567F, 1.90211654F, 1.96457517F, 1.99605417F,
    1.99605322F, 1.96457374F, 1.90211177F, 1.80965221F, 1.68865347F, 1.54102361F,
    1.36908531F, 1.17556667F, 0.963496387F, 0.7362445F, 0.497374862F,
    0.250661343F, -5.26116128E-6F, -0.250671774F, -0.497385055F, -0.736261368F,
    -0.963512301F, -1.17557514F, -1.36909842F, -1.54103029F, -1.68865907F,
    -1.80965674F, -1.90211499F, -1.96457565F, -1.99605381F, -1.9960531F,
    -1.96457326F, -1.90211093F, -1.80965114F, -1.68865204F, -1.54102194F,
    -1.36909449F, -1.17556453F, -0.963500857F, -0.736242115F, -0.497372389F,
    -0.25065881F, 7.82019288E-6F, 0.250674337F, 0.497387558F, 0.736249566F,
    0.963514566F, 1.17557728F, 1.36910033F, 1.54103196F, 1.6886605F, 1.80965781F,
    1.90211344F, 1.96457613F, 1.99605358F, 1.99605286F, 1.96457279F, 1.9021101F,
    1.80965006F, 1.68865478F, 1.54102039F, 1.3690927F, 1.1755625F, 0.963505268F,
    0.736239731F, 0.497369915F, 0.250663847F, -1.03792236E-5F, -0.250669301F,
    -0.497390032F, -0.73625195F, -0.963516831F, -1.17557311F, -1.36910224F,
    -1.54103351F, -1.68865776F, -1.80965889F, -1.90211415F, -1.9645766F,
    -1.9960537F, -1.99605274F, -1.96457374F, -1.90211177F, -1.80964899F,
    -1.68865347F, -1.54101872F, -1.3690908F, -1.17556047F, -0.963503063F,
    -0.73624444F, -0.497374833F, -0.250661314F, 1.29382552E-5F, 0.250671834F,
    0.497392505F, 0.736254334F, 0.963512361F, 1.17557526F, 1.36909854F,
    1.54103029F, 1.68865919F, 1.80966F, 1.90211499F, 1.96457708F, 1.99605381F,
    1.99605298F, 1.96457326F, 1.90211093F, 1.80965114F, 1.68865204F, 1.54101706F,
    1.36908889F, 1.17556453F, 0.963500798F, 0.736242056F, 0.497372359F,
    0.250658751F, -7.86789224E-6F, -0.250674367F, -0.497387588F, -0.736256719F,
    -0.963514626F, -1.17557728F, -1.36910033F, -1.54103196F, -1.6886605F,
    -1.80965781F, -1.90211582F, -1.96457624F, -1.99605405F, -1.99605286F,
    -1.96457279F, -1.9021101F, -1.80965006F, -1.68865073F, -1.54102027F,
    -1.3690871F, -1.1755625F, -0.963498592F, -0.736239672F, -0.497369885F,
    -0.250656217F, 2.79752885E-6F, 0.2506769F, 0.497390062F, 0.736259103F,
    0.963516831F, 1.17557931F, 1.36910224F, 1.54102874F, 1.68866181F,
    1.80965567F, 1.90211654F, 1.96457672F, 1.99605417F, 1.99605274F, 1.96457231F,
    1.90210938F, 1.80965221F, 1.6886493F, 1.54102349F, 1.36908519F, 1.17556047F,
    0.963496327F, 0.736237288F, 0.497374773F, 0.250653684F, -5.35656045E-6F,
    -0.250679463F, -0.497385174F, -0.736261487F, -0.963519096F, -1.17557526F,
    -1.36910415F, -1.54103041F, -1.68866324F, -1.80965674F, -1.90211737F,
    -1.96457577F, -1.99605381F, -1.9960525F, -1.96457326F, -1.90210855F,
    -1.80965114F, -1.68864799F, -1.54102194F, -1.36908329F, -1.17556453F,
    -0.963500738F, -0.736234963F, -0.497372299F, -0.250651151F, 7.9155916E-6F,
    0.250682F, 0.497387648F, 0.736256719F, 0.963514626F, 1.17557728F,
    1.36910594F, 1.54103196F, 1.68866467F, 1.80965781F, 1.90211582F, 1.96457624F,
    1.99605405F, 1.99605286F, 1.96457279F, 1.90210772F, 1.80965006F, 1.68865061F,
    1.54102027F, 1.36908698F, 1.1755625F, 0.963498533F, 0.736239672F,
    0.497369826F, 0.250648618F, -1.04746232E-5F, -0.25067696F, -0.497390121F,
    -0.736259103F, -0.963516891F, -1.17557943F, -1.36910224F, -1.54103363F,
    -1.68866193F, -1.809659F, -1.90211654F, -1.96457672F, -1.99605417F,
    -1.99605274F, -1.96457231F, -1.90211165F, -1.80964899F, -1.6886493F,
    -1.54101861F, -1.36908519F, -1.17556036F, -0.963496268F, -0.73624438F,
    -0.497367352F, -0.250661194F, 5.40426E-6F, 0.250687063F, 0.497392595F,
    0.736261487F, 0.963512421F, 1.17557526F, 1.36910415F, 1.54103529F,
    1.68865919F, 1.80965686F, 1.90211976F, 1.96457863F, 1.99605381F, 1.99605298F,
    1.96457326F, 1.90210617F, 1.80965114F, 1.68865204F, 1.54102182F, 1.36907768F,
    1.17555213F, 0.963500738F, 0.736242F, 0.49737227F, 0.250643522F,
    -7.96329095E-6F, -0.250674456F, -0.497387677F, -0.736256778F, -0.963528037F,
    -1.1755774F, -1.36910045F, -1.54103196F, -1.68866873F, -1.80965793F,
    -1.90211582F, -1.96457624F, -1.99605405F, -1.99605191F, -1.96457279F,
    -1.9021101F, -1.80965006F, -1.6886425F, -1.54102027F, -1.36908698F,
    -1.17556238F, -0.963498473F, -0.736225426F, -0.497369766F, -0.250656128F,
    1.05223226E-5F, 0.250677019F, 0.497390151F, 0.736259162F, 0.963516951F,
    1.17557943F, 1.36911345F, 1.54103363F, 1.68866193F, 1.809659F, 1.90211666F,
    1.96457672F, 1.99605417F, 1.99605274F, 1.96457231F, 1.90210927F, 1.80964887F,
    1.6886493F, 1.54101861F, 1.36908507F, 1.17556036F, 0.963496268F,
    0.736237228F, 0.497367293F, 0.250653595F, -1.30813542E-5F, -0.250679553F,
    -0.497392654F, -0.736261547F, -0.963519156F, -1.17558146F, -1.36910415F,
    -1.54103529F, -1.68866324F, -1.80966008F, -1.90211737F, -1.9645772F,
    -1.99605441F, -1.99605346F, -1.96457183F, -1.90210855F, -1.8096478F,
    -1.68864787F, -1.54101694F, -1.36908329F, -1.17555833F, -0.963494F,
    -0.736249F, -0.497364819F, -0.250651062F, 1.56403858E-5F, 0.250682086F,
    0.497395128F, 0.736263931F, 0.963521421F, 1.1755836F, 1.36909497F,
    1.54103684F, 1.68866467F, 1.80966115F, 1.90211821F, 1.96457481F, 1.99605453F,
    1.99605238F, 1.96457136F, 1.90211248F, 1.80964673F, 1.68864655F, 1.54101539F,
    1.36908138F, 1.17556858F, 0.963491738F, 0.73623246F, 0.497362345F,
    0.250663638F, -2.94062761E-6F, -0.250684619F, -0.497397602F, -0.736266315F,
    -0.963510275F, -1.17558563F, -1.36910796F, -1.54103851F, -1.68865788F,
    -1.80965579F, -1.90211892F, -1.96457815F, -1.99605465F, -1.99605322F,
    -1.96457088F, -1.90210688F, -1.80964565F, -1.68865335F, -1.54102349F,
    -1.36907959F, -1.17555416F, -0.963489532F, -0.736244261F, -0.497374654F,
    -0.250645965F, 2.07584471E-5F, 0.250672F, 0.497385293F, 0.736268699F,
    0.963525891F, 1.17558765F, 1.36909866F, 1.54103041F, 1.68866742F, 1.8096633F,
    1.90211511F, 1.96457577F, 1.99605489F, 1.99605203F, 1.96457028F, 1.90211082F,
    1.80965102F, 1.68864381F, 1.54101205F, 1.36908877F, 1.17556441F,
    0.963500619F, 0.736227691F, 0.497357398F, 0.250658572F, -8.05869058E-6F,
    -0.250689715F, -0.497402549F, -0.736256897F, -0.963514745F, -1.1755774F,
    -1.36911166F, -1.54104185F, -1.68866062F, -1.80965793F, -1.90212059F,
    -1.96457911F, -1.99605405F, -1.99605286F, -1.96457267F, -1.90210533F,
    -1.80964351F, -1.68865061F, -1.54102015F, -1.36908686F, -1.17555F,
    -0.963498414F, -0.736239493F, -0.497369677F, -0.250640899F, 2.58765103E-5F,
    0.250677109F, 0.49739027F, 0.736259282F, 0.963530362F, 1.17557955F,
    1.36910236F, 1.54103374F, 1.68866193F, 1.80966556F, 1.90211666F, 1.96457672F,
    1.99605417F, 1.99605179F, 1.96457219F, 1.90210927F, 1.80964887F, 1.68864918F,
    1.54100883F, 1.36908507F, 1.17556024F, 0.963496149F, 0.736222923F,
    0.497367203F, 0.250653505F, -1.31767529E-5F, -0.250679642F, -0.497407526F,
    -0.736261666F, -0.963519275F, -1.17558157F, -1.36910427F, -1.54103529F,
    -1.68866336F, -1.80966008F, -1.90211737F, -1.96458F, -1.99605441F,
    -1.9960525F, -1.96457171F, -1.90210843F, -1.8096478F, -1.68864787F,
    -1.54101694F, -1.36908317F, -1.17554581F, -0.963493943F, -0.736234784F,
    -0.49736473F, -0.250650942F, 1.57357845E-5F, 0.250682175F, 0.497395217F,
    0.73626405F, 0.963521481F, 1.1755836F, 1.36910617F, 1.54103696F, 1.68866467F,
    1.80966115F, 1.90211821F, 1.96457767F, 1.99605453F, 1.99605238F, 1.96457124F,
    1.90210772F, 1.80964673F, 1.68864644F, 1.54101527F, 1.36908126F, 1.17555606F,
    0.963491678F, 0.7362324F, 0.497362256F, 0.250648409F, -1.82948152E-5F,
    -0.250684708F, -0.497397691F, -0.736266375F, -0.963523746F, -1.17558575F,
    -1.36910796F, -1.54103863F, -1.68866611F, -1.80966234F, -1.90211904F,
    -1.96457815F, -1.99605465F, -1.99605227F, -1.96457076F, -1.90210688F,
    -1.80965209F, -1.68864512F, -1.5410136F, -1.36907947F, -1.17555404F,
    -0.963489413F, -0.73623F, -0.497359782F, -0.250645876F, 5.5950577E-6F,
    0.250687271F, 0.497400165F, 0.736268759F, 0.963526F, 1.17558777F,
    1.36910987F, 1.54104018F, 1.68866742F, 1.80965686F, 1.90211976F, 1.96457863F,
    1.99605489F, 1.99605203F, 1.96457314F, 1.90210617F, 1.80964458F, 1.68864369F,
    1.5410217F, 1.36907756F, 1.17555201F, 0.963487208F, 0.736227632F,
    0.497372061F, 0.250643343F, -2.34128784E-5F, -0.250689805F, -0.497387856F,
    -0.736271143F, -0.963528216F, -1.1755898F, -1.36911178F, -1.54103208F,
    -1.68866885F, -1.80966449F, -1.90212059F, -1.96457624F, -1.99605405F,
    -1.99605191F, -1.96456981F, -1.90210533F, -1.80965F, -1.68864238F,
    -1.54101038F, -1.36907578F, -1.17556226F, -0.963498294F, -0.736225247F,
    -0.497354805F, -0.25064081F, 1.07131209E-5F, 0.250677198F, 0.497405142F,
    0.736273527F, 0.96351707F, 1.17557955F, 1.36911356F, 1.54104352F,
    1.68867016F, 1.809659F, 1.90211666F, 1.96457958F, 1.99605513F, 1.99605274F,
    1.96457219F, 1.9021045F, 1.80964231F, 1.68864107F, 1.54101849F, 1.36908495F,
    1.17554784F, 0.963482738F, 0.736237049F, 0.497367114F, 0.250653416F,
    -2.85309416E-5F, -0.250694871F, -0.497392833F, -0.736261725F, -0.963532686F,
    -1.17559397F, -1.36910439F, -1.54103541F, -1.68866336F, -1.80966663F,
    -1.90212214F, -1.9645772F, -1.99605441F, -1.99605155F, -1.96456885F,
    -1.90210843F, -1.8096478F, -1.68864787F, -1.54100716F, -1.36907196F,
    -1.17555809F, -0.963493824F, -0.736234665F, -0.497349858F, -0.250650853F,
    1.58311832E-5F, 0.250682265F, 0.497410089F, 0.736278296F, 0.9635216F,
    1.17558372F, 1.36910617F, 1.54104674F, 1.68866479F, 1.80966127F, 1.90211821F,
    1.96458054F, 1.99605548F, 1.99605238F, 1.96457124F, 1.90210772F, 1.80964017F,
    1.68864644F, 1.54101527F, 1.36908126F, 1.17555606F, 0.963478208F,
    0.736232281F, 0.497362167F, 0.25064832F, -3.36490048E-5F, -0.250684828F,
    -0.49739778F, -0.736266494F, -0.963523805F, -1.17559814F, -1.36910808F,
    -1.54103863F, -1.68866611F, -1.80966234F, -1.90211904F, -1.96457815F,
    -1.99605465F, -1.99605227F, -1.9645679F, -1.90210688F, -1.80964553F,
    -1.68864501F, -1.5410136F, -1.36907935F, -1.17555392F, -0.963489354F,
    -0.736229897F, -0.497344911F, -0.250645787F, 2.09492464E-5F, 0.250687361F,
    0.497400254F, 0.736268878F, 0.96352607F, 1.17558789F, 1.36910987F,
    1.5410403F, 1.68866754F, 1.80966341F, 1.90211987F, 1.96457863F, 1.99605489F,
    1.99605203F, 1.96457028F, 1.90210605F, 1.80964446F, 1.68864369F, 1.54101193F,
    1.36907756F, 1.17555189F, 0.963487089F, 0.736227512F, 0.49735719F,
    0.250643253F, -2.35082771E-5F, -0.250689894F, -0.497402728F, -0.736271262F,
    -0.963528275F, -1.17557764F, -1.36911178F, -1.54104197F, -1.68866885F,
    -1.80966449F, -1.90212059F, -1.96457911F, -1.99605501F, -1.99605191F,
    -1.96457267F, -1.90210533F, -1.80964339F, -1.68864226F, -1.54101038F,
    -1.36908674F, -1.17554986F, -0.963484883F, -0.736225128F, -0.497369498F,
    -0.25064072F };

  int n;
  float anew;
  float bnew;
  double ndbl;
  double apnd;
  double absa;
  emxArray_real32_T *b_x_delay;
  int k;
  int nm1d2;
  emxArray_real32_T *b_x;
  float h[999];
  float c_x[1997];
  float zf[1996];
  static const double dv0[999] = { 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 };

  memcpy(&x[0], &fv0[0], 999U * sizeof(float));

  /* plot(x, 'r'); */
  /* hold on; */
  /* Echo */
  /* delay = 50; */
  /* a = 0.8; */
  if (rtIsNaNF(delay)) {
    n = 1;
    anew = ((real32_T)rtNaN);
    bnew = 1049.0F;
  } else if (1049.0F < delay) {
    n = 0;
    anew = delay;
    bnew = 1049.0F;
  } else if (rtIsInfF(delay)) {
    n = 1;
    anew = ((real32_T)rtNaN);
    bnew = 1049.0F;
  } else {
    anew = delay;
    ndbl = floor((1049.0 - delay) + 0.5);
    apnd = delay + ndbl;
    absa = fabs(delay);
    if (absa >= 1049.0) {
    } else {
      absa = 1049.0;
    }

    if (fabs(apnd - 1049.0) < 2.38418579E-7F * (float)absa) {
      ndbl++;
      bnew = 1049.0F;
    } else if (apnd - 1049.0 > 0.0) {
      bnew = (float)(delay + (ndbl - 1.0));
    } else {
      ndbl++;
      bnew = (float)apnd;
    }

    if (ndbl >= 0.0) {
      n = (int)ndbl;
    } else {
      n = 0;
    }
  }

  emxInit_real32_T(&b_x_delay, 2);
  k = b_x_delay->size[0] * b_x_delay->size[1];
  b_x_delay->size[0] = 1;
  b_x_delay->size[1] = n;
  emxEnsureCapacity((emxArray__common *)b_x_delay, k, (int)sizeof(float));
  if (n > 0) {
    b_x_delay->data[0] = anew;
    if (n > 1) {
      b_x_delay->data[n - 1] = bnew;
      k = n - 1;
      nm1d2 = k / 2;
      for (k = 1; k < nm1d2; k++) {
        b_x_delay->data[k] = anew + (float)k;
        b_x_delay->data[(n - k) - 1] = bnew - (float)k;
      }

      if (nm1d2 << 1 == n - 1) {
        b_x_delay->data[nm1d2] = (anew + bnew) / 2.0F;
      } else {
        b_x_delay->data[nm1d2] = anew + (float)nm1d2;
        b_x_delay->data[nm1d2 + 1] = bnew - (float)nm1d2;
      }
    }
  }

  anew = a * 2.0F;
  k = b_x_delay->size[0] * b_x_delay->size[1];
  b_x_delay->size[0] = 1;
  emxEnsureCapacity((emxArray__common *)b_x_delay, k, (int)sizeof(float));
  nm1d2 = b_x_delay->size[0];
  k = b_x_delay->size[1];
  nm1d2 *= k;
  for (k = 0; k < nm1d2; k++) {
    b_x_delay->data[k] = 125.663712F * (b_x_delay->data[k] * 0.001F);
  }

  emxInit_real32_T(&b_x, 2);
  k = b_x->size[0] * b_x->size[1];
  b_x->size[0] = 1;
  b_x->size[1] = b_x_delay->size[1];
  emxEnsureCapacity((emxArray__common *)b_x, k, (int)sizeof(float));
  nm1d2 = b_x_delay->size[0] * b_x_delay->size[1];
  for (k = 0; k < nm1d2; k++) {
    b_x->data[k] = b_x_delay->data[k];
  }

  for (k = 0; k + 1 <= b_x_delay->size[1]; k++) {
    b_x->data[k] = (float)sin(b_x->data[k]);
  }

  k = b_x_delay->size[0] * b_x_delay->size[1];
  b_x_delay->size[0] = 1;
  b_x_delay->size[1] = (int)delay + b_x->size[1];
  emxEnsureCapacity((emxArray__common *)b_x_delay, k, (int)sizeof(float));
  nm1d2 = (int)delay;
  for (k = 0; k < nm1d2; k++) {
    b_x_delay->data[b_x_delay->size[0] * k] = 0.0F;
  }

  nm1d2 = b_x->size[1];
  for (k = 0; k < nm1d2; k++) {
    b_x_delay->data[b_x_delay->size[0] * (k + (int)delay)] = anew * b_x->
      data[b_x->size[0] * k];
  }

  emxFree_real32_T(&b_x);
  for (k = 0; k < 999; k++) {
    x_delay[k] = b_x_delay->data[k];
  }

  emxFree_real32_T(&b_x_delay);

  /* plot(x_delay); */
  /* figure; */
  /* Echoed Signal% */
  /* plot(y); figure; */
  /* Impulse Response */
  memset(&h[0], 0, 999U * sizeof(float));
  h[0] = 1.0F;
  h[(int)delay - 1] = a;

  /* stem(t,h); */
  /*  Signal Recovered */
  for (k = 0; k < 999; k++) {
    c_x[k] = x[k] + x_delay[k];
  }

  memset(&c_x[999], 0, 998U * sizeof(float));
  filter(c_x, h, dv0, Q, zf);

  /* figure; */
  /* plot(Q, 'r'); hold on; plot(x); */
}

/*
 * File trailer for Echo.c
 *
 * [EOF]
 */
